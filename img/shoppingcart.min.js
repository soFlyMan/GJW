function Gocartplus(ID,Quantity,Increase,callbock){document.domain="gjw.com",getVastr(ID,Quantity,function(data){var json=data;if(0==json.Success)$.ajax({type:"POST",url:httpcook,data:{user_id:json.Message,ProductID:ID,Quantity:Quantity,Increase:Increase,vastr:json.Data},async:!1,datatype:"jsonp",success:function(t){t=JSON.parse(t),0==t.status?($(".itemNum").html(t.data),$(".fixnavbox a em").html(t.data),callbock(t)):layer.msg(t.msg)}});else{var shopping_cart=getUseCookie();$.ajax({type:"POST",url:httpcook,data:{ProductID:ID,Increase:Increase,Quantity:Quantity,shopping_cart:shopping_cart},async:!1,datatype:"JSON",success:function(data){var json=eval(data)[0];"True"==json.Success?(null==shopping_cart&&("null"==json.Message.split("_")[1]&&null==json.Message.split("_")[1]||(document.cookie="ShoppingCart="+json.Message.split("_")[1].replace(/\\/g,"\\")+";domain=gjw.com;path=/")),$(".itemNum").html(json.AcceptCount),$(".fixnavbox a em").html(json.AcceptCount),callbock(data)):layer.msg(json.Message.split("_")[0])}})}})}function Clear(){getVastr("",0,function(t){var a=JSON.parse(t);0==a.Success?$.ajax({type:"POST",url:clear,data:{user_id:a.Message,vastr:a.Data},async:!1,datatype:"JSON",success:function(t){window.location.reload()}}):$.ajax({type:"POST",url:clearcook,async:!1,datatype:"JSON",success:function(t){window.location.reload()}})})}function CartCountFn(){getVastr("",0,function(t){var a=t;if(0!=a.Success){var e=getUseCookie();$.ajax({type:"POST",url:CartCountCook,async:!1,datatype:"JSON",data:{shopping_cart:e},success:function(t){var a=JSON.parse(t);if("0"==a.Success){for(var e=0,c="",o=0,s=0;s<a.Data.length;s++)c+='<li class="v6_clear"><a href="http://order.gjw.com/product/item-id-'+a.Data[s].ID+'.htm" class="topBar_goodsImg fl"><img src="'+img_0(a.Data[s].Pic)+'" alt=""></a><a href="http://order.gjw.com/product/item-id-'+a.Data[s].ID+'.htm" class="topBar_goodsName fl">'+a.Data[s].Name+'</a><div class="fr"><div class="v6_hot topBar_price">￥'+a.Data[s].Price+"×"+a.Data[s].Quantity+'</div><a class="fr topBar_delete" onclick="Remove('+a.Data[s].ID+')">删除</a></div></li>',e+=parseFloat(a.Data[s].Price)*parseFloat(a.Data[s].Quantity),o+=a.Data[s].Quantity;$(".itemNum").html(o),0==a.Data.length&&(c='<img src="/v5/images/cart_none.png" alt="">'),$("#head_cart_no").html(o),$("#head_cart ul").html(c),$("#cartProCount").html(o),$(".fixnavbox a em").html(o),$("#cartcon").html(parseFloat(e).toFixed(2)),0===a.Data.length?$(".topBar_smb").hide():$(".topBar_smb").show()}else $(".topBar_smb").hide()}})}else $.ajax({type:"POST",url:CartCountCook,data:{user_id:a.Message,vastr:a.Data},async:!1,datatype:"jsonp",success:function(t){var a=JSON.parse(t);if(0==a.Success){for(var e=0,c=0;c<a.Data.length;c++)e+=a.Data[c].Quantity;$(".itemNum").html(e),$(".fixnavbox a em").html(e)}else alert(a.Message)}})})}function img_0(t){var a=t.split(".");return"http://img0.gjw.com/product/"+a[0]+"_0."+a[1]}function delCheck(){getVastr("",0,function(t){var a=JSON.parse(t);0==a.Success?$.ajax({type:"POST",url:RemoveCheck,data:{user_id:a.Message,vastr:a.Data},async:!1,datatype:"JSON",success:function(t){$(".tbcart td input").each(function(){if($(this).is(":checked")){var t=$(this).val();delCount(t)}})}}):$.ajax({type:"POST",url:RemoveCheckCook,async:!1,datatype:"JSON",success:function(t){$(".tbcart td input").each(function(){if($(this).is(":checked")){var t=$(this).val();delCount(t)}})}})}),CartCountFn()}function getVastr(t,a,e){$.ajax({type:"POST",url:vastr,data:{ProductID:t,Quantity:a},async:!1,datatype:"JSONP",success:function(t){e(t)}})}function Remove(t,a){getVastr(t,0,function(e){var c=JSON.parse(e);0==c.Success?$.ajax({type:"POST",url:apireMove,data:{user_id:c.Message,ProductID:t,vastr:c.Data},async:!1,datatype:"JSONP",success:function(e){"0"==e.status&&(a||delCount(t))}}):$.ajax({type:"POST",url:RemoveCook,data:{ProductID:t},async:!1,datatype:"JSONP",success:function(a){var e=JSON.parse(a);"0"==e.Success&&delCount(t)}})})}function delCount(t){$("#tbcart"+t).fadeOut();var a=$("#sum"+t+" b").html(),e=a.substring(1);$("#tbcart"+t+"  td input").is(":checked")||(e=0),calculationCount(e,!0),$("#tbcart"+t).remove()}function calculationCount(t,a){if(a)var e=$("#palyMoney").text().substring(1)-t;else var e=parseFloat($("#palyMoney").text().substring(1))+parseFloat(t);"0"==e||parseFloat(e)<0?(e=0,$("#ASettlement1").attr("href","javascript:alert('您的购物车内还没有要结算的商品，请选中购买！');")):$("#ASettlement1").attr("href","http://order.gjw.com/purchase/Settlement.htm"),$("#palyMoney").text("¥"+e.toFixed(2))}function Collect(t){$.ajax({type:"post",url:gj_DoMain+"/Gj_Api/collectPro",data:{id:t},async:!1,datatype:"json",success:function(a){0==a.Success?layer.msg(a.Message):3==a.Success?ifrmLogin.login(Collect,t):layer.msg(a.Message)}})}function EditQuantity(t,a,e){Gocartplus(t,a,!1,function(){$("#Quantity"+t).val(a);var c=$("#sum"+t+" b").html(),o=c.substring(1),s=$("#price"+t).text().trim().substring(1),r=$("#Pro"+t).text().trim().substring(3);""==r&&(r=0);var n=(parseFloat(o)+parseFloat(r))/s,i=o/n,u=r/n,l=1;parseFloat(n)>parseFloat(a)?(l=n-a,e=!0):(l=a-n,e=!1);var p=parseFloat(i*l).toFixed(2),h=parseFloat(i*a).toFixed(2);$("#tbcart"+t+"  td input").is(":checked")||(p=h,e=!1,$("#tbcart"+t+"  td input").attr("checked","checked")),""!=r&&$("#Pro"+t).text("立减¥"+parseFloat(u*a)),$("#sum"+t+" b").html("¥"+h),calculationCount(p,e)})}function ch(t,a){new Date;if("checked"==t.attr("checked")){$("#palyMoney").text("¥0"),$(".tbcart td input").each(function(){$(this).attr("checked","checked")}),$("#CheckAll").attr("checked","checked"),$("#check_All").attr("checked","checked");var e=0;$(".cs_sum b").each(function(){var t=$(this).html().substring(1);e=parseFloat(t)+parseFloat(e)}),calculationCount(e,!1),CheckAll(1,0)}else{$(".tbcart td input").each(function(){$(this).attr("checked",!1)}),$("#CheckAll").attr("checked",!1),$("#check_All").attr("checked",!1);var e=0;$(".cs_sum b").each(function(){var t=$(this).html().substring(1);e=parseFloat(t)+parseFloat(e)}),calculationCount(e,!0),CheckAll(2,0)}}function CheckAll(t,a){getVastr(a,t,function(e){var c=JSON.parse(e);0==c.Success?$.post(IscheckedPay,{user_id:c.Message,ProductID:a,Quantity:t,vastr:c.Data}):$.post(IscheckedPaycook,{ProductID:a,Quantity:t})})}function d(){var t=0,a=0;$(".tbcart td input").each(function(){t++,$(this).is(":checked")&&a++}),parseFloat(t)==2*parseFloat(a)&&($("#CheckAll").attr("checked","checked"),$("#check_All").attr("checked","checked"))}function name(){}function getCookie(t){var a,e=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(a=document.cookie.match(e))?unescape(a[2]):null}function getUseCookie(){return getCookie(null==getCookie("ShoppingCart")?"Pro_Cart":"ShoppingCart")}var apiCart="http://dbappservices.gjw.com/app/ShoppingCart/GoCartPC",apireMove="http://dbappservices.gjw.com/app/shoppingCart/RemovePC",IscheckedPay="http://dbappservices.gjw.com/app/shoppingCart/IsCheck",CartCount="http://dbappservices.gjw.com/app/shoppingCart/CartInfoPC",RemoveCheck="http://dbappservices.gjw.com/app/shoppingCart/RemoveCheck",clear="http://dbappservices.gjw.com/app/shoppingCart/ClearPC",httpcook="http://order.gjw.com/Ajax/order/ShoppingCart.htm?act=httpcook",vastr=gj_DoMain+"/Gj_Api/vastr",CartCountCook="http://order.gjw.com/Ajax/order/ShoppingCart.htm?act=CartCount",RemoveCook="http://order.gjw.com/Ajax/order/ShoppingCart.htm?act=RemoveCook",RemoveCheckCook="http://order.gjw.com/Ajax/order/ShoppingCart.htm?act=RemoveCheckCook",clearcook="http://order.gjw.com/Ajax/order/ShoppingCart.htm?act=clearcook",IscheckedPaycook="http://order.gjw.com/Ajax/order/ShoppingCart.htm?act=IscheckedPaycook";$("#myCart").hover(function(){var t=((new Date).getTime(),$("#head_cart"));CartCountFn(),t.Show()}),$(".num_down").click(function(t){var a=$(this).attr("index"),e=$(this).parent().parent().find(".Quantity").val();if(e)if(e>1){var c=parseInt(e)-1;EditQuantity(a,c,!0)}else alert("购买的商品数量不能小于1件!");else alert("数据不能为空")}),CartCountFn(),$(".num_up").click(function(t){var a=$(this).attr("index"),e=$(this).parent().parent().find(".Quantity").val();e?e>0?EditQuantity(a,parseInt(e)+1,!1):alert("购买的商品数量不能小于1件!"):alert("数据不能为空")}),$("#CheckAll").click(function(){ch($(this),0)}),$("#check_All").click(function(){ch($(this),0)}),$(".check_cb").click(function(){var t=(new Date,$(this).val()),a=$("#sum"+t+" b").html(),e=a.substring(1);"checked"==$(this).attr("checked")?(calculationCount(e,!1),d(),CheckAll(1,t)):(calculationCount(e,!0),$("#CheckAll").attr("checked",!1),$("#check_All").attr("checked",!1),CheckAll(2,t))}),$("#creaPro").click(function(){Clear()}),$(".shopping_poppup_onoff").click(function(){$("#shopping_poppup").hide()}),$("#delePro").click(function(){delCheck()});